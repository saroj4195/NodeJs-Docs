
# Booking Engine Flow Components

This document provides a comprehensive overview of all components involved in the Booking Engine flow—from API calls to database interactions, user-facing logic, and post-booking communication.

---

## 1. API Sequence & Usage

The Booking Engine performs a series of sequential API calls to fetch all the required configuration and dynamic data before enabling the booking process.

| Step | API Name                | Description                                                                |
| ---- | ----------------------- | -------------------------------------------------------------------------- |
| 1    | `get-hotel-info`        | Fetches core hotel data: room types, rate plans, room & hotel amenities.   |
| 2    | `auth`                  | Returns authenticated company-specific configuration and access control.   |
| 3    | `inventory-rate-fetch`  | Real-time fetch of inventory and rate based on selection and availability. |
| 4    | `hotels_by_company`     | Lists all hotels under the authenticated company (multi-property logic).   |
| 5    | `calendar-rate-fetch`   | Fetches 60-day rate snapshot for availability calendar display.            |
| 6    | `tax-details`           | Fetches applicable GST or service taxes as per room type and rate plan.    |
| 7    | `paid-services`         | Lists any extra/optional paid services available for guests.               |
| 8    | `deal-of-the-day`       | Compares property pricing vs. OTA pricing to display offer/value insights. |
| 9    | `add-on-charges`        | Retrieves conditional charges like early check-in, extra guests, etc.      |
| 10   | `get-be-plugin-details` | Provides configuration info related to the Booking Engine plugin.          |
| 11   | `be-notifications`      | Retrieves system-wide and hotel-specific notification content.          |

---

## 2. Guest Booking Flow

Once the above APIs load the necessary data, the following flow is triggered by guest interactions:

### **Frontend Booking Steps**:

1. **Select Dates** – Guest picks Check-in and Check-out dates.
2. **Select Room** – Available rooms and meal plans (rate plans) are shown.
3. **Apply Coupons (if available)** – Discount handling is triggered.
4. **Guest Info Entry** – Contact and guest detail collection.
5. **Payment Initiation** – Payment page loads with all charges + taxes.
6. **Booking Confirmation** – After payment success, booking is confirmed.

---

## 3. Booking Creation

* Once a booking is successfully made:

  * **Room Inventory** is reduced based on the selected dates and room.
  * **Payment** is recorded.
  * **Booking Voucher** is generated.

---

## 4. Notification Flow

* **Post-Booking Notifications**:

  * One voucher is emailed to the **Guest**.
  * One voucher is emailed to the **Hotelier** (with internal fields like payment mode, remarks, etc.).
  * SMS (optional) is triggered if mobile number is provided.
  * Webhook/event tracking is optionally fired if configured.

---

## 5. Plugin & UI Configuration

* The BE plugin supports dynamic UI rendering based on `get-be-plugin-details`.
* Examples:

  * Toggle coupon fields
  * Enable deal-of-the-day
  * Add-on visibility
  * GST input toggle

---

## 6. Supporting Modules

| Module            | Description                                                 |
| ----------------- | ----------------------------------------------------------- |
| Rate Calendar     | 2-month calendar showing per-day prices from calendar API   |
| Coupon Engine     | Validates coupons and applies discount in real time         |
| Tax Engine        | GST logic by room rate slabs and HSN codes                  |
| Add-on Services   | Enhances booking with optional services (spa, pickup, etc.) |
| Inventory Manager | Controls available room count using API + local adjustments |
| Plugin Renderer   | Reads plugin config and applies layout/styling dynamically  |

---

## 7. Database Models (Assumed - Laravel/MySQL or Prisma)

| Model           | Description                                   |
| --------------- | --------------------------------------------- |
| `Bookings`      | Stores all booking records                    |
| `Guests`        | Contains guest information                    |
| `Rooms`         | Room type master data                         |
| `RatePlans`     | Rate plan master (MAP, CP, etc.)              |
| `PaidServices`  | Optional add-on services with prices          |
| `Taxes`         | Tax rules for various room-rate combinations  |
| `Inventory`     | Tracks available room counts per date         |
| `Coupons`       | Promotional discounts and rules               |
| `Notifications` | Logs of vouchers and emails sent post-booking |

---

## 8. Helper Utilities

| Helper Name                | Description                                                                |
| -------------------------- | -------------------------------------------------------------------------- |
| `price-calculator.helper`  | Calculates total price based on date, guest count, meal plan, and add-ons. |
| `tax-calculation.helper`   | Calculates GST/service tax dynamically.                                    |
| `coupon-validation.helper` | Checks and applies discount codes.                                         |
| `inventory-check.helper`   | Confirms room availability before proceeding to booking.                   |
| `voucher-builder.helper`   | Builds structured PDF/HTML voucher for mail and guest UI.                  |

---

## 9. Payment Options

During the booking process, guests can choose from one of the following payment methods:

| Payment Type      | Description                                                                 |
| ----------------- | --------------------------------------------------------------------------- |
| **Prepaid**       | Guest pays the full amount online at the time of booking.                   |
| **Partial**       | Guest pays a partial amount (e.g., advance) online, rest at the property.   |
| **Pay at Hotel**  | No online payment is collected; the guest pays the full amount at check-in. |
| **Bank Transfer** | Guest transfers the amount manually via bank and uploads transaction proof. |

> Payment method availability may vary based on hotel configuration or rate plan rules.

---

## 10. Future Enhancements (Optional)

* **AI Assistant** to help with smart room selection and support.
* **Rebooking Flow** for modifying existing bookings.
* **Partial Payments** and split invoice options.
* **Webhooks/CRMs** for auto-syncing bookings to external systems.
